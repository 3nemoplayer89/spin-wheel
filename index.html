<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spin Wheel</title>
<style>
  body {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100vh; background: #f5f5f5; margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
  }
  .wheel-container { position: relative; }
  canvas { border: 4px solid #333; border-radius: 50%; background: #fff; }
  .pointer {
    position: absolute; top: -20px; left: 50%;
    transform: translateX(-50%) rotate(180deg);
    width: 0; height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 30px solid red;
    z-index: 10;
  }
  button {
    margin-top: 20px; padding: 10px 20px; font-size: 18px; cursor: pointer;
    border-radius: 10px; border: 1px solid #333; background: #fff;
  }
</style>
</head>
<body>

<div class="wheel-container">
  <canvas id="wheel" width="500" height="500"></canvas>
  <div class="pointer"></div>
</div>
<button id="spinBtn">Spin</button>

<script>
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const size = canvas.width;
const center = size / 2;
const radius = size / 2 - 10;

const places = ['Train Station', 'Again', 'Bonus', 'Library',
                'Classroom', 'Hospital', 'Market', 'Lab'];

const slice = 2 * Math.PI / places.length;

// ---- å·¥å…·ï¼šè®“ç¬¬ index ç‰‡çš„ã€Œä¸­å¿ƒã€å°é½Šç®­é ­ï¼ˆ12 é»æ–¹å‘ï¼‰ ----
function angleForIndex(index, offset = 0) {
  return -Math.PI / 2 - (index * slice + slice / 2) + offset;
}

// ä¸€é–‹å§‹å°±è®“ã€ŒBonusã€å°é½Šç®­é ­
let rotation = 0;
const bonusIndex = places.indexOf("Bonus");
rotation = angleForIndex(bonusIndex);

function drawWheel() {
  ctx.clearRect(0, 0, size, size);
  for (let i = 0; i < places.length; i++) {
    // æ‰‡å½¢
    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, radius, slice * i + rotation, slice * (i + 1) + rotation);
    ctx.closePath();
    ctx.fillStyle = i % 2 ? "#ffcc66" : "#66ccff";
    ctx.fill();
    ctx.stroke();

    // æ–‡å­—
    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(slice * i + slice / 2 + rotation);
    ctx.textAlign = "center";
    ctx.fillStyle = "#000";
    ctx.font = "16px Arial";
    ctx.fillText(places[i], radius - 60, 5);
    ctx.restore();
  }
}

drawWheel();

let spinning = false;
function spin() {
  if (spinning) return;
  spinning = true;

  const startRotation = rotation;
  const targetIndex = places.indexOf("Classroom"); // ğŸ¯ æœ€å¾Œè¦åœåœ¨ Classroom
  const offset = -0.25;  // åŠ ä¸€é»åç§»ï¼Œä¸è¦å®Œå…¨æ­£ä¸­é–“
  const targetAngle = angleForIndex(targetIndex, offset); 

  const extraSpins = 5 * 2 * Math.PI; // å¤šè½‰ 5 åœˆ
  const finalRotation = targetAngle + extraSpins;

  const duration = 4000; // 4 ç§’å‹•ç•«
  const start = performance.now();

  function animate(now) {
    const elapsed = now - start;
    const progress = Math.min(elapsed / duration, 1);
    const easeOut = 1 - Math.pow(1 - progress, 3); // ease-out cubic
    rotation = startRotation + (finalRotation - startRotation) * easeOut;
    drawWheel();

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      rotation = targetAngle; // ç²¾æº–åœåœ¨ Classroom + åç§»
      drawWheel();
      spinning = false;
      alert("We arrived at the CLASSROOM!");
    }
  }
  requestAnimationFrame(animate);
}

document.getElementById("spinBtn").addEventListener("click", spin);
</script>

</body>
</html>
